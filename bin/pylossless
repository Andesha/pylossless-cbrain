#!/usr/local/bin/python

import pylossless as ll
import mne
import mne_bids
import sys
from mne_bids import BIDSPath, read_raw_bids

subject_id = sys.argv[2]

# Define the specific subject you want
bids_path = BIDSPath(
    subject=subject_id,         # Subject ID without 'sub-' prefix
    root='/input/',
    datatype="eeg",        # or "meg", "ieeg" depending on your dataset
    suffix='eeg'  # or whatever the actual suffix is
)

# Read the raw data
raw = read_raw_bids(bids_path.match()[0])
raw.load_data()

config = ll.config.Config()
config.load_default()

pipeline = ll.LosslessPipeline(config=config)
pipeline.run_with_raw(raw)

# Save
bids_path = mne_bids.BIDSPath(subject=subject_id, task='cbrain', suffix='eeg', extension='.edf', datatype='eeg', root='/output/')
pipeline.save(pipeline.get_derivative_path(bids_path), overwrite=True)
